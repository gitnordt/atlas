<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if lt IE 7 ]> <html lang="en" class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en"> <!--<![endif]-->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Electronic Comment Filing System | FCC.gov</title>
<meta name="viewport" content="width=device-width, minimum-scale=0.5, user-scalable=yes, target-densitydpi=device-dpi"/>
 	
<link type="text/css" rel="stylesheet" media="all" href="css/content.css" />
<link type="text/css" rel="stylesheet" media="all" href="css/content-extended.css" />
<link type="text/css" rel="stylesheet" media="all" href="javascript/jquery-ui-1.11.2/jquery-ui.min.css" />
<link type="text/css" rel="stylesheet" media="print" href="css/frame.css" />
<link type="text/css" rel="stylesheet" href="css/shCore.css"/>
<link type="text/css" rel="stylesheet" href="css/shThemeDefault.css" />
<link type="text/css" rel="stylesheet" media="all" href="css/search.css" />
<link type="text/css" rel="stylesheet" media="all" href="javascript/dojo-1.10.2/dijit/themes/claro/claro.css" />
<link type="text/css" rel="stylesheet" media="all" href="javascript/dojo-1.10.2/dojox/grid/enhanced/resources/claro/EnhancedGrid.css" />
<link type="text/css" rel="stylesheet" media="all" href="javascript/dojo-1.10.2/dojox/grid/enhanced/resources/EnhancedGrid_rtl.css" />

<!--<script>dojoConfig = {parseOnLoad: true}</script>-->
<script type="text/javascript" src="javascript/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="javascript/jquery-ui-1.11.2/jquery-ui.js"></script>
<script type="text/javascript" src="javascript/jquery-drupal.js"></script>
<script type="text/javascript" src="javascript/application.js"></script>
<script type="text/javascript" src="javascript/jstorage.js"></script>
<script type="text/javascript" src="javascript/utils.js"></script>
<script type="text/javascript" src="javascript/page_layout.js"></script>
<script type="text/javascript" src="javascript/equalheight.js"></script>
<script type="text/javascript" src="javascript/shCore.js"></script>
<script type="text/javascript" src="javascript/shBrushXml.js"></script>
<script type='text/javascript' src='javascript/dojo-1.10.2/dojo/dojo.js'></script>
<script type="text/javascript" src="javascript/toolbox.js"></script>
<script type="text/javascript" src="javascript/results_grid.js"></script>
<script type='text/javascript' src='javascript/config.js'></script>
</head>

<body style="background:black;" class="nojs not-front not-logged-in page-node node-type-page no-sidebars claro">
	<div id="intro-div">
	</div>
	<!-- /intro-div -->
	<div id="contentWrapper">
		<div class="wrapper">
			<div id="hdr">
			</div>
			<!-- /hdr -->
			<div id="content-div">
				<a name="startcontent"></a>
				<div class="breadcrumb"><a href="http://www.fcc.gov/">FCC</a> / <a href="./index.html" class="active">ECFS</a> / <a href="./keyword-search.html" class="active">Keyword Search</a></div>
				<h1 id="content_span">Keyword Search
					<ul class="shareTools">
						<li><a href="/print/node/3895" target="_blank" class="print">Print</a></li>
						<li><a href="mailto:?subject=%53%65%6e%64%20%55%73%20%59%6f%75%72%20%43%6f%6d%6d%65%6e%74%73&body=http://www.fcc.gov/comments" class="email">Email</a></li>
					</ul>
				</h1>
				<div id="contentcontainer">
					<div id="topcontent"></div>
					<div id="maincontent" class="group">
						<div class="content-container">
								<div class="meta"></div>
								<div class="content">
									<div class="optionbox">
										<div id="optionbox_wrapper">
											<fieldset id="criteria">
												<legend>Search Criteria</legend>
												<div id="criteria_div">
													<div id="edit_title_div" style="float:left; width:10%;"><img id="edit-anchor" src="images/file_edit.png" class="icon-edit" alt="Edit Criteria"/></div>
													<div id="criteria_details" title="Criteria" class="megamenu criteriamenu"></div>
												</div>
											</fieldset>
											<fieldset id="activity">
												<legend>High Activity Filters</legend>
												<div id="info_title_div" style="float:left; width:10%;"><img id="info-anchor" src="images/info.png" class="icon-info" alt="More Information"/>
												</div>				
												<div id="filterGridDiv"></div> 
												<div id="activityDetailsDiv" style="visibility:hidden;display:none"></div>
											</fieldset>
											</br></br>
											<div id='dojo_grid' align="right">
												<p style="visibility:hidden;display:none" id='warning'></p>
												<div id="resultsGridDiv"></div>
										  </div>
										  <div id='no_results'>&nbsp;</div>
										</div>
									</div>
									
								</div>
								<p></p>
								<p></p>
						</div>
						<!-- /content-container -->
						
					</div>
					<!-- /maincontent -->
				</div>
				<!-- /contentcontainer -->
			</div> <!-- /contentdiv -->
			
			<div id="footer" class="group">
			</div>
			<!-- /footer -->

		</div>
		<!-- /wrapper -->
	</div>
	<!-- /contentWrapper -->
</body>
</html>
<script>
//var jq = jQuery.noConflict();
jQuery.extend(Drupal.settings, { "basePath": "/" });
</script>
<script type="text/javascript">
require(["dijit/Tooltip", "dojo/domReady!"]);

$(document).ready(function() {
	var search_term = $.jStorage.get("searchTerm");
	//console.log(search_term);
	var viewer_displayed = false;
	
	window.setTimeout(hovertipInit, 1);
	$("#search_term_input").val(search_term);
	$("label[for!='#search_term_input']").css("display", "none");
	$("#criteria_div").append("<div id='criteria_view'><p>Keyword: <br><span class='value-cool'>" + search_term + "</span></p></div>");
	$("#activity").append("<p><span class='value-cool'>Loading...<br>&nbsp;</span></p>");
	$("#criteria_details").append(getAnchorDetails(search_term));
	jq('.datepicker').datepicker({dateFormat: "mm/dd/yy", changeMonth: true, changeYear: true, showButtonPanel: true, yearRange: "-100:+5", closeText : "Close"}); 
	
	$(function() {
		jq( "#criteria_details" ).dialog({
			autoOpen: false,
			resizable: false,
			modal: true,
			position: {my: 'center', at: 'center'},
			show: { effect: "explode", duration: 1000 },
			hide: { effect: "explode", duration: 1000 }
		});	
		$( "#edit-anchor" ).click(function() {jq( "#criteria_details" ).dialog( "open" );})
	});

	function displayResults(results_url) {
		var start_time = new Date().getTime();
		var max_recs = getMaxRecords();
		var check_time = getCheckTime();
		
		var results = ajaxCall(results_url, 'json', false, true);
		//console.log(results.length);

		if(results.length >= max_recs){
			$('#warning').empty().append("<label>** Only displaying " + max_recs + " of 6 records.  Please refine your search.</label>");
		}
		
		if(results.length != 0){								
			dojo.ready(function(){
				//console.log(results);
				jsonHandler(results);
				$('#no_results').hide();
				if ($('#results').is(":hidden")){
					$('#results').show();
					dijit.byId("resultsGrid")._refresh();
					dijit.byId("filterGrid")._refresh();
				}
				viewer_displayed = true;
				/*filtering();*/
			});
			
			dojo.addOnLoad(function() {
			   $('#criteria').height($('#activity').height() - 1);
			   $('#criteria_div').height($('#criteria').height() - 16);
			});
		}
		else if(results.metadata.totalCount == 0){	
			$('#no_results').empty().append('<label>No results found.</label>');
		}

		
		/*$.getJSON(results_url, function(response) {
			console.log(" is this working");
			task_json=self.setInterval(function() {
				var timer = new Date().getTime() - start_time;
				console.log(timer + " secs");
				if(timer > getWaitTime()){
					self.clearInterval(task_json); //stops interval
					$('#no_results').empty().append('<label>Request timeout: Taking too long to retrieve results.</label>');
					return; //breaks loop and returns message
				}
				
				// Results logic start.
				
				$.getJSON(results_url, function(response) {
					console.log(response);
					if(response){
						if(response.metadata.queryStatus == "DONE"){
							self.clearInterval(task_json);
							if(response.metadata.totalCount >= max_recs){
								$('#warning').empty().append("<label>** Only displaying " + max_recs + " of " + response.metadata.totalCount + " records.  Please refine your search.</label>");
							}
							if(response.metadata.totalCount != 0){								
								dojo.ready(function(){
									jsonHandler(response);
									$('#no_results').hide();
									if ($('#results').is(":hidden")){
										$('#results').show();
										dijit.byId("resultsGrid")._refresh();
									}
									viewer_displayed = true;
									filtering();
								});
								
								dojo.addOnLoad(function() {
								   dojo.connect(window, "onresize", resizeGrid("resultsGrid");
								});
							}
							else if(response.metadata.totalCount == 0){	
								$('#no_results').empty().append('<label>No results found.</label>');
							}
						}
						else{
							console.log("not done querying: " + timer + " secs");
						}
					}
				})
				.fail(function() {
					$('#no_results').empty().append('<label>This query could not be submitted.</label>');
					self.clearInterval(task_json);
				});
				
				// Results logic end.
				
			},check_time); 	
		
		});	*/
	}

	//var results_url  = 'https://' + getHost() + '/queryservice/results/' + msg + '?callback=?';
	var results_url = 'mock_data.json';
	
	if(!viewer_displayed)
		$('#no_results').empty().append("<label><span class='value-cool'>Loading...</span></label>");
	
	if (viewer_displayed) {
		$('#results').hide();
		$('#no_results').fadeIn(400);
		$('#no_results').empty().append("<label><span class='value-cool'>Loading...</span></label>");

		viewer_displayed = false;
	}
	
	$('#warning').empty();
	displayResults(results_url);

});

require(["dijit/Tooltip", "dojo/domReady!"], function(Tooltip){
	new Tooltip({
		id: "activity_tooltip",
		connectId: "info-anchor",
		label: "<legend>Details:</legend><p class='paragraph-style'>Displayed are the number of filings based on Proceedings, Filing Type, and State.<br>Also displayed are the totals for brief comments versus expert comments. <br>Clicking on a link will filter the results table below.</p>"
	});
});


</script>
